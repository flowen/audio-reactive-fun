function preload(e){return console.log("preloading song: "+currentSong),allSounds[currentSong]?(console.log("same song"),sound=allSounds[currentSong],sound.setVolume(volume),void sound.play()):(allSounds[e]=sound=new p5.SoundFile("songs/"+e.filename,onMusicLoaded,h.onError),console.log(allSounds),console.log("allSounds[currentSong]"),console.log(allSounds[currentSong]),console.log("allSounds[song]"),console.log(allSounds[e]),void sound.setVolume(volume))}function onMusicLoaded(){$loader.addClass("hidden"),sound.play()}function newSong(){var e=h.getRandomInt(0,songs.length-1);preload(songs[currentSong]),currentSong<songs.length-1?currentSong++:currentSong=0,thisSong=songs[currentSong],fbass=thisSong.fbass,fmid=thisSong.fmid,bassDetect=new p5.PeakDetect(fbass.x1,fbass.x2,fbass.t),midDetect=new p5.PeakDetect(fmid.x1,fmid.x2,fmid.t)}function getSpectrum(){var e=fft.analyze();bassDetect.update(fft),midDetect.update(fft),bassDetect.isDetected&&newImage(),midDetect.isDetected&&newImage()}function stroboBlack(){tl.to(overlay,.07,{opacity:1}).to(overlay,.01,{opacity:0})}function stroboWhite(){tl.to(overlay,.07,{opacity:1,backgroundColor:"#fff"}).to(overlay,.01,{opacity:0,backgroundColor:"#000"})}function newImage(){var e=assLoader.resources,n=Object.keys(e),t=h.getRandomInt(0,n.length-1),o=e[n[t]];return t===currentImage?void newImage():(currentImage=t,displacementTexture=new PIXI.Sprite.fromImage("dmaps/"+o.name),displacementTexture.width=windowWidth,stage.addChild(displacementTexture),stage.children.length>4&&stage.removeChildren(4),displacementFilter=new PIXI.filters.DisplacementFilter(displacementTexture),mainVisual=new PIXI.Sprite.fromImage(o.url),mainVisual.width=windowWidth,mainVisual.height=.7*windowHeight,stage.addChild(mainVisual),void(mainVisual.filters=[displacementFilter]))}function initPixiContainer(){stage=new PIXI.Container,stage.imageSmoothingEnabled=!1,renderer=new PIXI.autoDetectRenderer(windowWidth,windowHeight,{view:document.getElementById("canvas")}),console.log("All assets loaded in assLoader.resources"),newImage(),requestAnimationFrame(animate)}function animate(){var e=(windowWidth-mainVisual.width)/2,n=(windowHeight-mainVisual.height)/2;mainVisual.position.x=e,mainVisual.position.y=n;var t=(windowWidth-displacementTexture.width)/2,o=(windowHeight-displacementTexture.height)/2;displacementTexture.position.x=t,displacementTexture.position.y=o,displacementFilter.scale.x+=1.25,getSpectrum(),sound.onended(function(){newSong()}),renderer.render(stage),requestAnimationFrame(animate)}for(var $loader=$(".loader"),$btnNewSong=$(".new-song"),songs=[{filename:"sample-aphex-l.mp3",fbass:{x1:0,x2:50,t:.9},fmid:{x1:80,x2:120,t:.9}},{filename:"sample-priest.mp3",fbass:{x1:0,x2:70,t:.9},fmid:{x1:90,x2:120,t:.9}},{filename:"sample-jamie.mp3",fbass:{x1:0,x2:60,t:.7},fmid:{x1:120,x2:180,t:1}},{filename:"sample-impala.mp3",fbass:{x1:40,x2:90,t:.5},fmid:{x1:80,x2:140,t:1}}],allSounds=[],sprites=["berlin.jpg","flying.jpg","ganesh.jpg","japan.jpg","moondark.jpg","moonlight.jpg","nihon.jpg","space.jpg","terminator.jpg"],fft=new p5.FFT,volume=1,fadeout=1,currentSong=0,sound,thisSong,fbass,fmid,bassDetect,midDetect,currentImage,mainVisual,displacementFilter,displacementTexture,imageInterval,stage,renderer,windowWidth=window.innerWidth,windowHeight=window.innerHeight,assLoader=PIXI.loader,i=0;i<sprites.length;i++)assLoader.add(sprites[i],"images/"+sprites[i]);$btnNewSong.on("click",function(){sound.stop()});var overlay=$(".canvas-overlay"),tl=new TimelineLite;newSong(),assLoader.once("complete",initPixiContainer());
//# sourceMappingURL=./ardmoi-min.js.map