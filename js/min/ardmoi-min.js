function preload(e){console.log("preloading song: "+currentSong),console.log(e.filename),sound=new p5.SoundFile("songs/"+e.filename,onMusicLoaded,h.onError),sound.setVolume(volume)}function onMusicLoaded(){$loader.addClass("hidden"),sound.play()}function newSong(){var e=h.getRandomInt(0,songs.length-1);preload(songs[currentSong]),currentSong<songs.length-1?currentSong++:currentSong=0,thisSong=songs[currentSong],fbass=thisSong.fbass,fmid=thisSong.fmid,bassDetect=new p5.PeakDetect(fbass.x1,fbass.x2,fbass.t),midDetect=new p5.PeakDetect(fmid.x1,fmid.x2,fmid.t)}function getSpectrum(){var e=fft.analyze();bassDetect.update(fft),midDetect.update(fft),bassDetect.isDetected&&newImage(),midDetect.isDetected&&newImage()}function stroboBlack(){tl.to(overlay,.07,{opacity:1}).to(overlay,.01,{opacity:0})}function stroboWhite(){tl.to(overlay,.07,{opacity:1,backgroundColor:"#fff"}).to(overlay,.01,{opacity:0,backgroundColor:"#000"})}function newImage(){var e=assLoader.resources,t=Object.keys(e),n=h.getRandomInt(0,t.length-1),i=e[t[n]];return n===currentImage?void newImage():(currentImage=n,totalSpritesOnStage.push(i),totalSpritesOnStage.length>4&&(stage.removeChild(totalSpritesOnStage[0]),stage.removeChild(totalSpritesOnStage[1]),totalSpritesOnStage.shift(),totalSpritesOnStage.shift()),displacementTexture=new PIXI.Sprite.fromImage("dmaps/"+i.name),displacementTexture.width=windowWidth,stage.addChild(displacementTexture),totalSpritesOnStage.push(displacementTexture),console.log(totalSpritesOnStage),displacementFilter=new PIXI.filters.DisplacementFilter(displacementTexture),mainVisual=new PIXI.Sprite.fromImage(i.url),mainVisual.width=windowWidth,stage.addChild(mainVisual),void(mainVisual.filters=[displacementFilter]))}function initPixiContainer(){console.log("initPixiContainer"),stage=new PIXI.Container,renderer=new PIXI.autoDetectRenderer(windowWidth,windowHeight,{view:document.getElementById("canvas")}),console.log("All assets loaded in assLoader.resources"),newImage(),requestAnimationFrame(animate)}function animate(){var e=(windowWidth-mainVisual.width)/2,t=(windowHeight-mainVisual.height)/2;mainVisual.position.x=e,mainVisual.position.y=t;var n=(windowWidth-displacementTexture.width)/2,i=(windowHeight-displacementTexture.height)/2;displacementTexture.position.x=n,displacementTexture.position.y=i,displacementFilter.scale.x+=1.25,getSpectrum(),sound.onended(function(){newSong()}),renderer.render(stage),requestAnimationFrame(animate)}for(var $loader=$(".loader"),$btnNewSong=$(".new-song"),songs=[{filename:"sample-aphex-l.mp3",fbass:{x1:0,x2:60,t:.8},fmid:{x1:70,x2:120,t:.7}},{filename:"sample-priest.mp3",fbass:{x1:0,x2:90,t:.7},fmid:{x1:70,x2:140,t:.8}},{filename:"sample-jamie.mp3",fbass:{x1:0,x2:60,t:.7},fmid:{x1:90,x2:110,t:.7}},{filename:"sample-impala.mp3",fbass:{x1:40,x2:70,t:.7},fmid:{x1:70,x2:110,t:.9}}],sprites=["berlin.jpg","flying.jpg","ganesh.jpg","japan.jpg","moondark.jpg","moonlight.jpg","nihon.jpg","space.jpg","terminator.jpg"],fft=new p5.FFT,volume=1,fadeout=1,currentSong=0,sound,thisSong,fbass,fmid,bassDetect,midDetect,currentImage,mainVisual,displacementFilter,displacementTexture,imageInterval,stage,renderer,windowWidth=window.innerWidth,windowHeight=window.innerHeight,assLoader=PIXI.loader,i=0;i<sprites.length;i++)assLoader.add(sprites[i],"images/"+sprites[i]);$btnNewSong.on("click",function(){sound.stop()});var overlay=$(".canvas-overlay"),tl=new TimelineLite,totalSpritesOnStage=[];newSong(),assLoader.once("complete",initPixiContainer());
//# sourceMappingURL=./ardmoi-min.js.map